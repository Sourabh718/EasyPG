<%- include('../partials/head') %>
<link rel="stylesheet" href="/css/favourites.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <%- include('../partials/nav') %>
  <%- include('../partials/sidebar') %>   
  <div class="container-size"> 
  <% if (favouriteHomes.length === 0) { %>
    <div class="empty-container">
    <h2 class="fs-1 text-danger fw-bold text-start mb-4 ps-4">Saved item's</h2> 
    <img src="../image/Screenshot 2025-08-25 142501.png" alt="bag image" class="mx-auto d-block" style="width:300px; height:300px;"> 
      <h3 class="title">Your Favourites List is Empty</h3>
     <p class="empty-text">You don‚Äôt have any favourite homes yet.</p>
      <a href="/user/home-list" class="back-btn">‚Üê Back to Listings</a>
    </div>
  <% } else { %>
    <main class="main-container">
      <h2 class="title">Saved Items</h2>
      
      <div class="card-grid">
        <% favouriteHomes.forEach(home => { %>
          <div class="card">
            <img src="<%= home.photoUrl %>" alt="<%= home.houseName %>" class="card-img">
            
            <div class="card-body">
              <h3 class="card-title"><%= home.houseName %></h3>
              <p class="card-location">üìç <%= home.location %></p>
              
              <div class="card-info">
                <span class="card-price">‚Çπ<%= home.price %> / Month</span>
                <span class="card-rating">‚≠ê <%= home.rating %></span>
              </div>
              <button class="remove-btn btn btn-danger" data-id="<%= home._id %>">‚ùå Remove from Favourites</button>
                  
            </div>
            <script>
            document.addEventListener("DOMContentLoaded", () => {
              document.querySelectorAll(".remove-btn").forEach(button => {
                button.addEventListener("click", async () => {
                  const homeId = button.dataset.id;

                  try {
                    const res = await fetch(`/user/remove-favourite/${homeId}`, {
                      method: "POST",
                      headers: {
                        "Accept": "application/json"
                      }
                    });

                    const data = await res.json();

                    if (data.success) {
                      const card = button.closest(".card");
                      if (card) card.remove(); // Remove the home card from the DOM
                    } else {
                      console.error("Failed to remove favourite");
                    }
                  } catch (err) {
                    console.error("Error removing favourite:", err);
                  }
                });
              });
            });
            </script>
          </div>
        <% }) %>
      </div>
    </main>
  <% } %>
  </div>
  <%- include('../partials/footer') %>
</body>
</html>
